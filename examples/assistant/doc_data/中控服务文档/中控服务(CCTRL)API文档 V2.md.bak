## 中控服务(CCTRL):API文档 V2

### API 接口

| api名称                | 请求方式 | url                                                     | comments         |
| :--------------------- | :------- | :------------------------------------------------------ | :--------------- |
| query                  | POST     | `http://bot-cctrl-service/api/v1/cctrl/query`           | 对话请求         |
| status                 | GET      | `http://bot-cctrl-service/api/v1/cctrl/status`          | 服务状态查询     |
| version                | GET      | `http://bot-cctrl-service/api/v1/cctrl/version`         | 版本查询         |


### query 请求

#### 1. 请求格式
JSON

#### 2. 请求参数
| 参数          | 类型   | 是否必选 | 描述                                                         |
| :------------ | :----- | :------- | :----------------------------------------------------------- |
| bot_id        | uint64 | 是       | 表示机器人id                                                     |
| sess_id       | string | 是       | 表示session id                                                   |
| query         | string | 是       | 表示请求的具体内容                                               |
| **time_zone** | string | 是       | 表示当前query的具体时区。比如`Etc/GMT+8`，详情参加附录1  |
| **country_code** | string | 是       | 表示当前query的国家码。<br>其格式与[https://countrycode.org](https://countrycode.org)中COUNTRY CODE字段一致|
| debug         | string | 否       | 表示是否返回调试信息<br>"on"：返回, "off"：不返回。 不填时等同于"off" |

#### 3. 返回参数
| 参数          | 类型   | 是否必选 | 描述                                                         |
| ---------------- | ------ | ---------- | ------------------------------------------------------------ |
| err_code         | 是     | int        | 表示错误码<br>非零时表示有错误，并返回错误消息                             |
| err_msg          | 否     | string     | 表示提示性错误消息                                               |
| bot_type         | 是     | string     | 表示bot类型<br>取值范围：`FAQ_BOT`, `EAOG_BOT`, `KG_BOT`, `CHAT_BOT`         |
| bot_id           | 是     | uint64     | 表示机器人id<br>与对应请求时一致                                   |
| sess_id          | 是     | string     | 表示session id<br>与对应请求时一致                                 |
| **type**         | 否     | string     | 表示faq<br>当bot_type=`FAQ_BOT`时：<br>type=`keyword`时表示是核心词匹配;    <br>type=`synonym`时表示是核心词同义词匹配;<br>    type=`keyword_rule`时表示，核心词规则泛化;<br>    type=`no_keyword`时表示没有用到核心词相关的。<br>当bot_type=`EAOG_BOT`时:<br>    type=`instruction`时表示EAOG动作指令输出;<br>    type=`answer`时表示EAOG文本回复输出。<br>当bot_type=`KG_BOT`时，后续再定义。<br>当bot_type=`CHAT_BOT`时，没有该字段。 |
| result           | 否     | list[json] | 表示返回结果<br>err_code为非零时，没有此字段                    |
| **+instruction** | 否     | dict       | 表示动作指令输出<br>当bot_type=`EAOG_BOT`时，type=`instruction`表示当前EAOG_BOT动作指令的输出；type=`answer`没有该字段<br>其他bot_type没有该字段。 |
| +answer          | 是     | string     | 表示文本回复输出<br>当bot_type=`EAOG_BOT`时，type=`answer`表示当前EAOG_BOT文本回复指令的输出；type=`instruction`没有该字段|
| +question        | 否     | string     | 表示推荐的相似问题<br>当bot_type=`FAQ_BOT`时，并且最大置信度在0.2和0.8之间，那么FAQ会列出相似问题, 用于推荐给用户。<br>当bot_type=`EAOG_BOT`时,没有该字段<br>当bot_type=`CHAT_BOT`时，没有该字段。 |
| +confidence      | 否     | float      | 表示文本回复置信度<br>当bot_type=`FAQ_BOT`时，表示FAQ的置信度<br>当bot_type=`AOG_BOT`时，没有该字段。<br>当bot_type=`CHAT_BOT`时，没有该字段。 |
| intent       | 否     | string     | 仅当debug字段为"on"时有效<br>当bot_type=`EAOG_BOT`时，表示当前用户query的意图<br>其他bot_type没有该字段 |
| params       | 否     | list[dict] | 仅当debug字段为"on"时有效<br>当bot_type=`EAOG_BOT`时，表示当前用户query的意图对应的槽位<br>其他bot_type没有该字段 |
| +param_name  | 否     | string     | 表示槽名                                                         |
| +origin      | 否     | string     | 表示槽的原始值                                                   |
| +value       | 否     | string     | 表示槽的标准值                                                   |
| score        | 否     | float      | 仅当debug字段为"on"时有效<br><br>当bot_type=`EAOG_BOT`时，表示当前用户query的意图置信度<br>其他bot_type没有该字段 |


#### 4. 示例

##### (1) EAOG_BOT请求-正确示例( type=`answer`时)
请求示例
```json
{
    "bot_id": 1234,
    "sess_id": "ssfddsfdf",
    "query": "I want to buy a train ticket",
    "time_zone": "Asia/Shanghai",
    "country_code": "86",
    "debug": "on"
}
```
返回示例:
```json
{
	"err_code": 0,
	"bot_id": 1234,
    "sess_id": "ssfddsfdf",
	"bot_type": "EAOG_BOT",
    "type": "answer",
	"result": [
		{
			"answer": "要购买哪一天的火车票呢？"
		}
	]
}
```
##### (1) EAOG_BOT请求-正确示例( type=`instruction`时)
请求示例
```json
{
    "bot_id": 1234,
    "sess_id": "ssfddsfdf",
    "query": "open bluetooth",
    "time_zone": "Asia/Shanghai",
    "country_code": "86",
    "debug": "on"
}
```
返回示例:
```json
{
	"err_code": 0,
	"bot_id": 1234,
    "sess_id": "ssfddsfdf",
	"bot_type": "EAOG_BOT",
    "type": "instruction",
	"result": [
		{
			"instruction": 
            {
                    "ins_name": "action_trun_on_settings",
                    "ins_params":
                    {
                      "device.name": "BLUETOOTH"
                    }      
            }
		}
	]
}
```

##### (2) FAQ_BOT请求-正确示例( type=`keyword_rule`时，或type=`no_keyword`时)
请求示例
```json
{
    "bot_id": 1234,
    "sess_id": "ssfddsfdf",
    "query": "老咳嗽咋回事",
    "time_zone": "Asia/Shanghai",
    "country_code": "86",
    "debug": "on"
}
```
返回示例:
```json
{
	"err_code": 0,
	"bot_id": 1234,
    "sess_id": "ssfddsfdf",
	"bot_type": "FAQ_BOT",
    "type": "no_keyword",
	"result": [
        {
            "answer": "https://wechat.dxy.cn/japi/weixin/news/group/28018/d4e4e19ba5cacd0b74a6707ffc6d4e5a",
           "confidence": 0.8844898343086243,
           "question": "孩子发烧咳嗽怎么办？"
        }
    ]
}
```

##### (3) FAQ_BOT请求-正确示例( type=keyword时，或type=synonym时)
请求示例
```json
{
    "bot_id": 1234,
    "sess_id": "ssfddsfdf",
    "query": "老咳嗽咋回事",
    "time_zone": "Asia/Shanghai",
    "country_code": "86",
    "debug": "on"
}
```
返回示例:
```json
{
	"err_code": 0,
	"bot_id": 1234,
    "sess_id": "ssfddsfdf",
	"bot_type": "FAQ_BOT",
    "type": "keyword",
	"result": [
		{
			"question": "信用卡还款怎么算利息",
			"answer": "一千元一天利息5角...",
			"confidence": 0.8500000238418579
		},
        {
        	"question": "银行卡异地能换卡吗",
        	"answer": "不能，目前银行卡...",
       		"confidence": 0.8489999771118164
       	}
    ]
}
```
##### (4) CHAT_BOT请求-正确示例( type=keyword时，或type=synonym时)
请求示例
```json
{
    "bot_id": 1234,
    "sess_id": "ssfddsfdf",
    "query": "我今天好开心啊",
    "time_zone": "Asia/Shanghai",
    "country_code": "86",
    "debug": "on"
}
```
返回示例:
```json
{
	"err_code": 0,
	"bot_id": 1234,
    "sess_id": "ssfddsfdf",
 	"bot_type": "CHAT_BOT",
 	"result": [{"answer": "你开心我也开心。"}]
}
```
##### (5) BOT请求-错误返回示例
```json
{
	"err_code": 1000,
	"err_msg": "this is error!"
}
```

### 附录1-timezone取值列表
| timezone时区名称                 | 
| :--------- |
| "Africa/Abidjan",
| "Africa/Accra",
| "Africa/Addis_Ababa",
| "Africa/Algiers",
| "Africa/Asmera",
| "Africa/Bamako",
| "Africa/Bangui",
| "Africa/Banjul",
| "Africa/Bissau",
| "Africa/Blantyre",
| "Africa/Brazzaville",
| "Africa/Bujumbura",
| "Africa/Cairo",
| "Africa/Casablanca",
| "Africa/Ceuta",
| "Africa/Conakry",
| "Africa/Dakar",
| "Africa/Dar_es_Salaam",
| "Africa/Djibouti",
| "Africa/Douala",
| "Africa/El_Aaiun",
| "Africa/Freetown",
| "Africa/Gaborone",
| "Africa/Harare",
| "Africa/Johannesburg",
| "Africa/Kampala",
| "Africa/Khartoum",
| "Africa/Kigali",
| "Africa/Kinshasa",
| "Africa/Lagos",
| "Africa/Libreville",
| "Africa/Lome",
| "Africa/Luanda",
| "Africa/Lubumbashi",
| "Africa/Lusaka",
| "Africa/Malabo",
| "Africa/Maputo",
| "Africa/Maseru",
| "Africa/Mbabane",
| "Africa/Mogadishu",
| "Africa/Monrovia",
| "Africa/Nairobi",
| "Africa/Ndjamena",
| "Africa/Niamey",
| "Africa/Nouakchott",
| "Africa/Ouagadougou",
| "Africa/Porto-Novo",
| "Africa/Sao_Tome",
| "Africa/Tripoli",
| "Africa/Tunis",
| "Africa/Windhoek",
| "America/Anchorage",
| "America/Anguilla",
| "America/Antigua",
| "America/Araguaina",
| "America/Argentina/Buen",res
| "America/Aruba",
| "America/Asuncion",
| "America/Bahia",
| "America/Barbados",
| "America/Belem",
| "America/Belize",
| "America/Boa_Vista",
| "America/Bogota",
| "America/Campo_Grande",
| "America/Caracas",
| "America/Cayenne",
| "America/Cayman",
| "America/Chicago",
| "America/Costa_Rica",
| "America/Cuiaba",
| "America/Curacao",
| "America/Danmarkshavn",
| "America/Dawson_Creek",
| "America/Denver",
| "America/Dominica",
| "America/Edmonton",
| "America/El_Salvador",
| "America/Fortaleza",
| "America/Godthab",
| "America/Grand_Turk",
| "America/Grenada",
| "America/Guadeloupe",
| "America/Guatemala",
| "America/Guayaquil",
| "America/Guyana",
| "America/Halifax",
| "America/Havana",
| "America/Hermosillo",
| "America/Iqaluit",
| "America/Jamaica",
| "America/La_Paz",
| "America/Lima",
| "America/Los_Angeles",
| "America/Maceio",
| "America/Managua",
| "America/Manaus",
| "America/Martinique",
| "America/Mazatlan",
| "America/Mexico_City",
| "America/Miquelon",
| "America/Montevideo",
| "America/Montreal",
| "America/Montserrat",
| "America/Nassau",
| "America/New_York",
| "America/Noronha",
| "America/Panama",
| "America/Paramaribo",
| "America/Phoenix",
| "America/Port-au-Prince",
| "America/Port_of_Spain",
| "America/Porto_Velho",
| "America/Puerto_Rico",
| "America/Recife",
| "America/Regina",
| "America/Rio_Branco",
| "America/Santiago",
| "America/Santo_Domingo",
| "America/Sao_Paulo",
| "America/Scoresbysund",
| "America/St_Johns",
| "America/St_Kitts",
| "America/St_Lucia",
| "America/St_Thomas",
| "America/St_Vincent",
| "America/Tegucigalpa",
| "America/Thule",
| "America/Tijuana",
| "America/Toronto",
| "America/Tortola",
| "America/Vancouver",
| "America/Whitehorse",
| "America/Winnipeg",
| "America/Yellowknife",
| "Antarctica/Casey",
| "Antarctica/Davis",
| "Antarctica/DumontDUrvi",
| "Antarctica/Mawson",
| "Antarctica/McMurdo",
| "Antarctica/Palmer",
| "Antarctica/Rothera",
| "Antarctica/South_Pole",
| "Antarctica/Syowa",
| "Antarctica/Vostok",
| "Asia/Aden",
| "Asia/Almaty",
| "Asia/Amman",
| "Asia/Aqtau",
| "Asia/Aqtobe",
| "Asia/Ashgabat",
| "Asia/Baghdad",
| "Asia/Bahrain",
| "Asia/Baku",
| "Asia/Bangkok",
| "Asia/Beirut",
| "Asia/Bishkek",
| "Asia/Brunei",
| "Asia/Calcutta",
| "Asia/Choibalsan",
| "Asia/Colombo",
| "Asia/Damascus",
| "Asia/Dhaka",
| "Asia/Dili",
| "Asia/Dubai",
| "Asia/Dushanbe",
| "Asia/Gaza",
| "Asia/Hong_Kong",
| "Asia/Hovd",
| "Asia/Irkutsk",
| "Asia/Jakarta",
| "Asia/Jayapura",
| "Asia/Jerusalem",
| "Asia/Kabul",
| "Asia/Kamchatka",
| "Asia/Karachi",
| "Asia/Katmandu",
| "Asia/Krasnoyarsk",
| "Asia/Kuala_Lumpur",
| "Asia/Kuwait",
| "Asia/Macau",
| "Asia/Magadan",
| "Asia/Makassar",
| "Asia/Manila",
| "Asia/Muscat",
| "Asia/Nicosia",
| "Asia/Omsk",
| "Asia/Phnom_Penh",
| "Asia/Pyongyang",
| "Asia/Qatar",
| "Asia/Rangoon",
| "Asia/Riyadh",
| "Asia/Saigon",
| "Asia/Seoul",
| "Asia/Shanghai",
| "Asia/Singapore",
| "Asia/Taipei",
| "Asia/Tashkent",
| "Asia/Tbilisi",
| "Asia/Tehran",
| "Asia/Thimphu",
| "Asia/Tokyo",
| "Asia/Ulaanbaatar",
| "Asia/Vientiane",
| "Asia/Vladivostok",
| "Asia/Yakutsk",
| "Asia/Yekaterinburg",
| "Asia/Yerevan",
| "Atlantic/Azores",
| "Atlantic/Bermuda",
| "Atlantic/Canary",
| "Atlantic/Cape_Verde",
| "Atlantic/Faeroe",
| "Atlantic/Reykjavik",
| "Atlantic/South_Georgia",
| "Atlantic/St_Helena",
| "Atlantic/Stanley",
| "Australia/Adelaide",
| "Australia/Brisbane",
| "Australia/Darwin",
| "Australia/Eucla",
| "Australia/Hobart",
| "Australia/Perth",
| "Australia/Sydney",
| "Etc/GMT",
| "Europe/Amsterdam",
| "Europe/Andorra",
| "Europe/Athens",
| "Europe/Belgrade",
| "Europe/Berlin",
| "Europe/Brussels",
| "Europe/Bucharest",
| "Europe/Budapest",
| "Europe/Chisinau",
| "Europe/Copenhagen",
| "Europe/Dublin",
| "Europe/Gibraltar",
| "Europe/Helsinki",
| "Europe/Istanbul",
| "Europe/Kaliningrad",
| "Europe/Kiev",
| "Europe/Lisbon",
| "Europe/London",
| "Europe/Luxembourg",
| "Europe/Madrid",
| "Europe/Malta",
| "Europe/Minsk",
| "Europe/Monaco",
| "Europe/Moscow",
| "Europe/Oslo",
| "Europe/Paris",
| "Europe/Prague",
| "Europe/Riga",
| "Europe/Rome",
| "Europe/Samara",
| "Europe/Sofia",
| "Europe/Stockholm",
| "Europe/Tallinn",
| "Europe/Tirane",
| "Europe/Vaduz",
| "Europe/Vienna",
| "Europe/Vilnius",
| "Europe/Warsaw",
| "Europe/Zurich",
| "Indian/Antananarivo",
| "Indian/Chagos",
| "Indian/Christmas",
| "Indian/Cocos",
| "Indian/Comoro",
| "Indian/Kerguelen",
| "Indian/Mahe",
| "Indian/Maldives",
| "Indian/Mauritius",
| "Indian/Mayotte",
| "Indian/Reunion",
| "Pacific/Apia",
| "Pacific/Auckland",
| "Pacific/Chatham",
| "Pacific/Easter",
| "Pacific/Efate",
| "Pacific/Enderbury",
| "Pacific/Fakaofo",
| "Pacific/Fiji",
| "Pacific/Funafuti",
| "Pacific/Galapagos",
| "Pacific/Gambier",
| "Pacific/Guadalcanal",
| "Pacific/Guam",
| "Pacific/Honolulu",
| "Pacific/Johnston",
| "Pacific/Kiritimati",
| "Pacific/Kosrae",
| "Pacific/Kwajalein",
| "Pacific/Majuro",
| "Pacific/Marquesas",
| "Pacific/Midway",
| "Pacific/Nauru",
| "Pacific/Niue",
| "Pacific/Norfolk",
| "Pacific/Noumea",
| "Pacific/Pago_Pago",
| "Pacific/Palau",
| "Pacific/Pitcairn",
| "Pacific/Ponape",
| "Pacific/Port_Moresby",
| "Pacific/Rarotonga",
| "Pacific/Saipan",
| "Pacific/Tahiti",
| "Pacific/Tarawa",
| "Pacific/Tongatapu",
| "Pacific/Truk",
| "Pacific/Wake",
| "Pacific/Wallis"